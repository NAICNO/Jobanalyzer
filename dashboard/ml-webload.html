<!--

Simple presentation of system JSON data.
    
TODO:

UX
 - handle files that don't exist (eg ml4 has no data in sonalyze output, hence no file produced)
   right now there's a fetch error but probably should have something better - either force the creation
   of the file, or throw up a message
 - tooltip could show user:job for top jobs, see more below

Functionality
 - see if jobgraph has anything to offer in terms of ideas
 - this is maybe a bridge too far, but it would be possible, for any point, to have a list of either
   the user names or command names or job numbers (or maybe username:job) that are the top consumers,
   usually there will be just a few.  that way, this dashboard serves the purpose of visualizing the
   cpu hogs.  not urgent.
 - is it useful to select absolute data rather than relative data?  NO.

-->

<html>
  <head>
    <title>NAIC ML-Nodes dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard.js"></script>
    <script>
      var my_chart = null;

      function setup() {
	  with_systems_and_frequencies(function (systems, frequencies) {
	      populateDropdown(document.getElementById("ml_node"), systems)
	      populateDropdown(document.getElementById("frequency"), frequencies)
	      reload()
	  })
      }

      function reload() {
	  let nodename = document.getElementById("ml_node").value
	  let frequency = document.getElementById("frequency").value
	  let show_data = document.getElementById("show_data").checked
	  let show_downtime = document.getElementById("show_downtime").checked
	  let chart_node = document.getElementById("ml_chart");
	  let desc_node = document.getElementById("system_description")

	  with_chart_data(nodename, frequency, function (json_data) {
	      if (my_chart != null)
		  my_chart.destroy()
	      my_chart = plot_system(json_data, chart_node, desc_node, show_data, show_downtime)
	  })
      }
    </script>
  </head>
  <body onload="setup()">

    <select id=ml_node name="ML Node" onchange="reload()"></select>
    <select id=frequency name="Frequency" onchange="reload()"></select>
    <input type=checkbox id=show_data name="Show data" onchange="reload()" checked>Show data</input>
    <input type=checkbox id=show_downtime name="Show downtime" onchange="reload()">Show downtime</input>

    <div><canvas id="ml_chart"></canvas></div>

    <div>&nbsp;</div>
    <div>Data are relative to all system resources (e.g., 100% CPU
      means all cores are completely busy; 100% GPU means all cards are completely busy).</div>
    <div>&nbsp;</div>
    <div>Main memory (RAM) can go
    over 100% due to paging and similar system effects; the
    measurement is the sum of the sizes of the jobs' private memories. </div>
    <div>&nbsp;</div>
    <b>
    <div id=system_description>
    </div>
    </b>

  </body>
</html>
